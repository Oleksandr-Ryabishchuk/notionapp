<div class="dashboard">
  <header>
    <h1>Your Active Sessions</h1>
    <p class="active-count">{{ activeTabs$() }} active tab(s) / {{ allTabs().length }} total</p>
    <!-- @if (isLoading()) {
      <p class="loading">Syncing...</p>
    } -->
    @if (error()) {
      <p class="error">{{ error() }}</p>
    }
    <button (click)="signOut()" class="logout-btn">Sign Out</button>
  </header>

  @if (allTabs().length === 0) {
    <div class="no-tabs">
      <p>No tabs active. Open a new tab to track your session.</p>
    </div>
  } @else {
    <div class="devices-container">
      @for (group of groupedTabs(); track group.deviceId) {
        <div class="device-group">
          <h2>{{ group.deviceId ? 'Device is tracked' : 'Device is not tracked' }}</h2>
          
          <div class="tabs-list">
            @for (tab of group.tabs; track tab.tab_id) {
              <div [ngClass]="['tab-item', getTabState(tab)]"
                   [class.current]="isCurrentTab(tab.tab_id)">
                
                <div class="tab-header">
                  <span class="tab-indicator" [ngClass]="getTabState(tab)"></span>
                  <span class="tab-id">{{ tab.tab_id | slice:0:8 }}</span>
                  @if (isCurrentTab(tab.tab_id)) {
                    <span class="current-badge">CURRENT</span>
                  }
                </div>

                <div class="tab-details">
                  <p><strong>State:</strong> {{ getTabState(tab) | uppercase }}</p>
                  <p><strong>Is Active:</strong> {{ tab.is_active ? '✓ Yes' : '✗ No' }}</p>
                  <p><strong>Last Seen:</strong> {{ formatLastSeen(tab.last_seen) }}</p>
                  <p><strong>User Agent:</strong> {{ tab.user_agent | slice:0:50 }}...</p>
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
</div>
